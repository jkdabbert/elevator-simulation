<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Elevator Simulation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .controls {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }

        .control-row {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .control-group label {
            font-size: 14px;
            font-weight: 600;
        }

        .control-group input, .control-group select {
            padding: 8px 12px;
            border: none;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            font-size: 14px;
            width: 120px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn-primary {
            background: #4CAF50;
            color: white;
        }

        .btn-primary:hover {
            background: #45a049;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #2196F3;
            color: white;
        }

        .btn-secondary:hover {
            background: #1976D2;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #f44336;
            color: white;
        }

        .btn-danger:hover {
            background: #d32f2f;
            transform: translateY(-2px);
        }

        .simulation-area {
            display: flex;
            gap: 30px;
            min-height: 600px;
        }

        .building {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            flex: 1;
            backdrop-filter: blur(10px);
        }

        .building-header {
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .floors-container {
            display: flex;
            flex-direction: column-reverse;
            gap: 3px;
        }

        .floor {
            display: flex;
            align-items: center;
            min-height: 60px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 10px;
            position: relative;
            border: 2px solid transparent;
        }

        .floor.active {
            border-color: #4CAF50;
            background: rgba(76, 175, 80, 0.2);
        }

        .floor-number {
            width: 40px;
            text-align: center;
            font-weight: bold;
            font-size: 18px;
        }

        .floor-calls {
            flex: 1;
            display: flex;
            gap: 10px;
            margin: 0 15px;
        }

        .call-btn {
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .call-up {
            background: #4CAF50;
            color: white;
        }

        .call-down {
            background: #FF9800;
            color: white;
        }

        .call-btn:hover {
            transform: scale(1.1);
        }

        .call-btn.active {
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .elevators-area {
            display: flex;
            gap: 10px;
            min-width: 200px;
        }

        .elevator-shaft {
            width: 80px;
            position: relative;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 5px;
        }

        .elevator {
            position: absolute;
            width: 70px;
            height: 50px;
            background: linear-gradient(145deg, #667eea, #764ba2);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            transition: all 0.5s ease-in-out;
            border: 2px solid transparent;
        }

        .elevator.moving {
            border-color: #4CAF50;
            box-shadow: 0 0 15px rgba(76, 175, 80, 0.5);
        }

        .elevator-id {
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 2px;
        }

        .elevator-floor {
            font-size: 16px;
            font-weight: bold;
        }

        .elevator-direction {
            font-size: 10px;
            margin-top: 2px;
        }

        .elevator-doors {
            position: absolute;
            bottom: -3px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 3px;
            background: rgba(255, 255, 255, 0.2);
        }

        .elevator-doors.open {
            background: #4CAF50;
            color: white;
        }

        .status-panel {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            width: 350px;
            backdrop-filter: blur(10px);
            max-height: 600px;
            overflow-y: auto;
        }

        .status-header {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 15px;
            text-align: center;
        }

        .elevator-status {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            border-left: 4px solid #2196F3;
        }

        .elevator-status.active {
            border-left-color: #4CAF50;
            background: rgba(76, 175, 80, 0.1);
        }

        .status-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .status-requests {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 12px;
        }

        .console-log {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            max-height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.4;
        }

        .console-log .log-entry {
            margin-bottom: 2px;
            color: #00ff00;
        }

        .console-log .log-entry.info {
            color: #87CEEB;
        }

        .console-log .log-entry.warn {
            color: #FFD700;
        }

        .quick-actions {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .quick-actions h4 {
            margin-bottom: 10px;
            font-size: 14px;
        }

        .preset-btn {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            margin: 2px;
            font-size: 12px;
            transition: all 0.2s ease;
        }

        .preset-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        @media (max-width: 1024px) {
            .simulation-area {
                flex-direction: column;
            }
            
            .status-panel {
                width: 100%;
                max-height: 400px;
            }
        }

        @media (max-width: 768px) {
            .control-row {
                flex-direction: column;
                align-items: stretch;
            }
            
            .control-group input {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè¢ Interactive Elevator Simulation</h1>
            <p>SCAN Algorithm with Multi-Elevator Coordination</p>
        </div>

        <div class="controls">
            <div class="control-row">
                <div class="control-group">
                    <label>Number of Elevators:</label>
                    <input type="number" id="numElevators" min="1" max="8" value="2">
                </div>
                <div class="control-group">
                    <label>Number of Floors:</label>
                    <input type="number" id="numFloors" min="3" max="50" value="10">
                </div>
                <div class="control-group">
                    <label>Speed (floors/sec):</label>
                    <input type="number" id="speed" min="0.1" max="5" step="0.1" value="0.5">
                </div>
                <div class="control-group">
                    <label>Door Time (sec):</label>
                    <input type="number" id="doorTime" min="0.5" max="10" step="0.5" value="1.5">
                </div>
            </div>
            <div class="control-row">
                <button class="btn btn-primary" onclick="initializeSimulation()">üèóÔ∏è Build System</button>
                <button class="btn btn-secondary" onclick="startSimulation()" id="startBtn">‚ñ∂Ô∏è Start Simulation</button>
                <button class="btn btn-secondary" onclick="pauseSimulation()" id="pauseBtn" disabled>‚è∏Ô∏è Pause</button>
                <button class="btn btn-danger" onclick="resetSimulation()">üîÑ Reset</button>
                <button class="btn btn-secondary" onclick="clearLog()">üßπ Clear Log</button>
            </div>
        </div>

        <div class="simulation-area">
            <div class="building">
                <div class="building-header">Building Floors & Call Buttons</div>
                <div class="floors-container" id="floorsContainer">
                    <!-- Floors will be generated here -->
                </div>
            </div>

            <div class="elevators-area" id="elevatorsArea">
                <!-- Elevator shafts will be generated here -->
            </div>

            <div class="status-panel">
                <div class="status-header">System Status</div>
                <div id="statusContainer">
                    <!-- Status will be updated here -->
                </div>

                <div class="quick-actions">
                    <h4>Quick Test Scenarios:</h4>
                    <button class="preset-btn" onclick="rushHourTest()">üö∂‚Äç‚ôÇÔ∏è Rush Hour</button>
                    <button class="preset-btn" onclick="randomTest()">üé≤ Random Calls</button>
                    <button class="preset-btn" onclick="stressTest()">‚ö° Stress Test</button>
                    <button class="preset-btn" onclick="singleFloorTest()">üîù Top Floor</button>
                </div>

                <div class="console-log" id="consoleLog">
                    <div class="log-entry info">üè¢ Elevator Simulation Ready</div>
                    <div class="log-entry">Click "Build System" to start</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global simulation state
        let elevatorSystem = null;
        let simulationInterval = null;
        let isRunning = false;
        let logCount = 0;

        // Direction constants
        const Direction = { UP: 1, DOWN: -1, IDLE: 0 };
        const DoorState = { OPEN: 'OPEN', CLOSED: 'CLOSED', OPENING: 'OPENING', CLOSING: 'CLOSING' };

        // Enhanced Elevator class for visual simulation
        class VisualElevator {
            constructor(elevatorId, minFloor = 1, maxFloor = 10, speed = 0.5, doorTime = 1.5) {
                this.elevatorId = elevatorId;
                this.minFloor = minFloor;
                this.maxFloor = maxFloor;
                this.currentFloor = 1;
                this.direction = Direction.IDLE;
                this.doorState = DoorState.CLOSED;
                this.floorRequests = [];
                this.hallRequests = [];
                this.isMoving = false;
                this.capacity = 8;
                this.currentPassengers = 0;
                
                // Timing configurations
                this.floorTravelTime = 1000 / speed; // milliseconds per floor
                this.doorOperationTime = doorTime * 1000;
                this.stopTime = 3000;
                
                // Visual state
                this.targetFloor = null;
                this.moveStartTime = null;
                this.element = null;
            }

            requestFloor(floor) {
                if (!this._isValidFloor(floor)) {
                    log(`Elevator ${this.elevatorId}: Invalid floor ${floor}`, 'warn');
                    return false;
                }
                
                if (floor === this.currentFloor && this.doorState === DoorState.CLOSED) {
                    log(`Elevator ${this.elevatorId}: Already at floor ${floor}`, 'info');
                    return true;
                }
                
                if (!this.floorRequests.includes(floor)) {
                    this.floorRequests.push(floor);
                    this.floorRequests.sort((a, b) => a - b);
                    log(`Elevator ${this.elevatorId}: Floor ${floor} requested from inside`);
                }
                
                return true;
            }

            callElevator(floor, direction) {
                if (!this._isValidFloor(floor)) {
                    log(`Elevator ${this.elevatorId}: Invalid floor ${floor}`, 'warn');
                    return false;
                }
                
                if ((floor === this.maxFloor && direction === Direction.UP) ||
                    (floor === this.minFloor && direction === Direction.DOWN)) {
                    log(`Elevator ${this.elevatorId}: Invalid direction from floor ${floor}`, 'warn');
                    return false;
                }
                
                const existingRequest = this.hallRequests.find(
                    req => req.floor === floor && req.direction === direction
                );
                
                if (!existingRequest) {
                    this.hallRequests.push({ floor, direction, timestamp: Date.now() });
                    log(`Elevator ${this.elevatorId}: Called to floor ${floor} going ${this._getDirectionName(direction)}`);
                }
                
                return true;
            }

            _isValidFloor(floor) {
                return floor >= this.minFloor && floor <= this.maxFloor;
            }

            _getDirectionName(direction) {
                if (direction === Direction.UP) return 'UP';
                if (direction === Direction.DOWN) return 'DOWN';
                return 'IDLE';
            }

            _getNextDestination() {
                const allFloors = new Set(this.floorRequests);
                
                for (const request of this.hallRequests) {
                    if (this.direction === Direction.IDLE ||
                        request.direction === this.direction ||
                        request.floor === this.currentFloor ||
                        (this.direction === Direction.UP && request.floor > this.currentFloor) ||
                        (this.direction === Direction.DOWN && request.floor < this.currentFloor)) {
                        allFloors.add(request.floor);
                    }
                }
                
                if (allFloors.size === 0) return null;
                
                const floorsArray = Array.from(allFloors);
                
                if (this.direction === Direction.UP || this.direction === Direction.IDLE) {
                    const upFloors = floorsArray.filter(f => f > this.currentFloor);
                    if (upFloors.length > 0) {
                        return Math.min(...upFloors);
                    }
                }
                
                if (this.direction === Direction.DOWN || this.direction === Direction.IDLE) {
                    const downFloors = floorsArray.filter(f => f < this.currentFloor);
                    if (downFloors.length > 0) {
                        return Math.max(...downFloors);
                    }
                }
                
                if (this.direction !== Direction.IDLE && floorsArray.length > 0) {
                    return floorsArray.reduce((closest, current) => 
                        Math.abs(current - this.currentFloor) < Math.abs(closest - this.currentFloor) 
                            ? current : closest
                    );
                }
                
                return null;
            }

            _updateDirection(destination) {
                if (destination > this.currentFloor) {
                    this.direction = Direction.UP;
                } else if (destination < this.currentFloor) {
                    this.direction = Direction.DOWN;
                } else {
                    this.direction = Direction.IDLE;
                }
            }

            _removeCompletedRequests(floor) {
                const floorIndex = this.floorRequests.indexOf(floor);
                if (floorIndex !== -1) {
                    this.floorRequests.splice(floorIndex, 1);
                }
                
                this.hallRequests = this.hallRequests.filter(
                    req => !(req.floor === floor && 
                            (req.direction === this.direction || this.direction === Direction.IDLE))
                );
            }

            async runCycle() {
                const destination = this._getNextDestination();
                
                if (destination === null) {
                    this.direction = Direction.IDLE;
                    this.isMoving = false;
                    return false;
                }
                
                // Move to destination
                await this._moveToFloor(destination);
                
                // Open doors
                await this._openDoors();
                
                // Wait for passengers
                await this._wait(this.stopTime);
                
                // Remove completed requests
                this._removeCompletedRequests(destination);
                
                // Close doors
                await this._closeDoors();
                
                return true;
            }

            async _moveToFloor(targetFloor) {
                if (targetFloor === this.currentFloor) return;
                
                this._updateDirection(targetFloor);
                this.targetFloor = targetFloor;
                this.isMoving = true;
                this.moveStartTime = Date.now();
                
                const floorsToTravel = Math.abs(targetFloor - this.currentFloor);
                const travelTime = floorsToTravel * this.floorTravelTime;
                
                log(`Elevator ${this.elevatorId}: Moving ${this._getDirectionName(this.direction)} from floor ${this.currentFloor} to ${targetFloor}`);
                
                await this._wait(travelTime);
                
                this.currentFloor = targetFloor;
                this.isMoving = false;
                this.targetFloor = null;
                log(`Elevator ${this.elevatorId}: Arrived at floor ${this.currentFloor}`);
            }

            async _openDoors() {
                log(`Elevator ${this.elevatorId}: Opening doors at floor ${this.currentFloor}`, 'info');
                this.doorState = DoorState.OPENING;
                await this._wait(this.doorOperationTime);
                this.doorState = DoorState.OPEN;
            }

            async _closeDoors() {
                log(`Elevator ${this.elevatorId}: Closing doors at floor ${this.currentFloor}`, 'info');
                this.doorState = DoorState.CLOSING;
                await this._wait(this.doorOperationTime);
                this.doorState = DoorState.CLOSED;
            }

            async _wait(duration) {
                return new Promise(resolve => setTimeout(resolve, duration));
            }

            getStatus() {
                return {
                    elevatorId: this.elevatorId,
                    currentFloor: this.currentFloor,
                    direction: this._getDirectionName(this.direction),
                    doorState: this.doorState,
                    isMoving: this.isMoving,
                    floorRequests: [...this.floorRequests],
                    hallRequests: this.hallRequests.map(req => ({
                        floor: req.floor,
                        direction: this._getDirectionName(req.direction)
                    })),
                    currentPassengers: this.currentPassengers,
                    capacity: this.capacity
                };
            }

            updateVisualPosition() {
                if (!this.element) return;
                
                let displayFloor = this.currentFloor;
                
                // Animate movement between floors
                if (this.isMoving && this.targetFloor && this.moveStartTime) {
                    const elapsed = Date.now() - this.moveStartTime;
                    const totalTime = Math.abs(this.targetFloor - this.currentFloor) * this.floorTravelTime;
                    const progress = Math.min(elapsed / totalTime, 1);
                    
                    displayFloor = this.currentFloor + (this.targetFloor - this.currentFloor) * progress;
                }
                
                // Calculate position (floors are displayed in reverse order)
                const maxFloor = this.maxFloor;
                const floorHeight = 63; // floor height + gap
                const position = (maxFloor - displayFloor) * floorHeight + 10;
                
                this.element.style.top = position + 'px';
                
                // Update elevator info
                this.element.querySelector('.elevator-floor').textContent = Math.floor(displayFloor);
                this.element.querySelector('.elevator-direction').textContent = this._getDirectionName(this.direction);
                
                // Update door state
                const doors = this.element.querySelector('.elevator-doors');
                doors.textContent = this.doorState;
                doors.className = 'elevator-doors' + (this.doorState === DoorState.OPEN ? ' open' : '');
                
                // Update moving state
                this.element.className = 'elevator' + (this.isMoving ? ' moving' : '');
            }
        }

        class ElevatorController {
            constructor(numElevators = 2, minFloor = 1, maxFloor = 10, speed = 0.5, doorTime = 1.5) {
                this.elevators = [];
                for (let i = 0; i < numElevators; i++) {
                    this.elevators.push(new VisualElevator(i + 1, minFloor, maxFloor, speed, doorTime));
                }
                this.minFloor = minFloor;
                this.maxFloor = maxFloor;
            }

            callElevator(floor, direction) {
                if (floor < this.minFloor || floor > this.maxFloor) {
                    return false;
                }
                
                // Find the best elevator
                let bestElevator = null;
                let bestScore = Infinity;
                
                for (const elevator of this.elevators) {
                    let score = Math.abs(elevator.currentFloor - floor);
                    
                    if (elevator.direction === direction) {
                        score -= 2;
                    }
                    
                    if (elevator.isMoving || elevator.floorRequests.length > 0 || elevator.hallRequests.length > 0) {
                        score += 1;
                    }
                    
                    if (score < bestScore) {
                        bestScore = score;
                        bestElevator = elevator;
                    }
                }
                
                if (bestElevator) {
                    return bestElevator.callElevator(floor, direction);
                }
                
                return false;
            }

            getSystemStatus() {
                return this.elevators.map(elevator => elevator.getStatus());
            }
        }

        // UI Functions
        function log(message, type = 'log') {
            const consoleLog = document.getElementById('consoleLog');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            
            const timestamp = new Date().toLocaleTimeString();
            entry.textContent = `[${timestamp}] ${message}`;
            
            consoleLog.appendChild(entry);
            consoleLog.scrollTop = consoleLog.scrollHeight;
            
            // Limit log entries
            logCount++;
            if (logCount > 100) {
                consoleLog.removeChild(consoleLog.firstChild);
                logCount--;
            }
        }

        function clearLog() {
            const consoleLog = document.getElementById('consoleLog');
            consoleLog.innerHTML = '<div class="log-entry info">üè¢ Console cleared</div>';
            logCount = 1;
        }

        function initializeSimulation() {
            const numElevators = parseInt(document.getElementById('numElevators').value);
            const numFloors = parseInt(document.getElementById('numFloors').value);
            const speed = parseFloat(document.getElementById('speed').value);
            const doorTime = parseFloat(document.getElementById('doorTime').value);

            // Validation
            if (numElevators < 1 || numElevators > 8) {
                alert('Number of elevators must be between 1 and 8');
                return;
            }
            
            if (numFloors < 3 || numFloors > 50) {
                alert('Number of floors must be between 3 and 50');
                return;
            }

            // Reset simulation
            pauseSimulation();
            
            // Create new elevator system
            elevatorSystem = new ElevatorController(numElevators, 1, numFloors, speed, doorTime);
            
            // Generate UI
            generateFloors(numFloors);
            generateElevators(numElevators, numFloors);
            
            log(`üèóÔ∏è Building initialized: ${numElevators} elevators, ${numFloors} floors`, 'info');
            log(`‚öôÔ∏è Speed: ${speed} floors/sec, Door time: ${doorTime}s`, 'info');
            
            // Enable start button
            document.getElementById('startBtn').disabled = false;
        }

        function generateFloors(numFloors) {
            const container = document.getElementById('floorsContainer');
            container.innerHTML = '';
            
            for (let floor = 1; floor <= numFloors; floor++) {
                const floorDiv = document.createElement('div');
                floorDiv.className = 'floor';
                floorDiv.id = `floor-${floor}`;
                
                const floorNumber = document.createElement('div');
                floorNumber.className = 'floor-number';
                floorNumber.textContent = floor;
                
                const callsDiv = document.createElement('div');
                callsDiv.className = 'floor-calls';
                
                // Add up button (except top floor)
                if (floor < numFloors) {
                    const upBtn = document.createElement('button');
                    upBtn.className = 'call-btn call-up';
                    upBtn.textContent = '‚Üë';
                    upBtn.onclick = () => callElevator(floor, Direction.UP, upBtn);
                    callsDiv.appendChild(upBtn);
                }
                
                // Add down button (except ground floor)
                if (floor > 1) {
                    const downBtn = document.createElement('button');
                    downBtn.className = 'call-btn call-down';
                    downBtn.textContent = '‚Üì';
                    downBtn.onclick = () => callElevator(floor, Direction.DOWN, downBtn);
                    callsDiv.appendChild(downBtn);
                }
                
                // Add internal request buttons
                const internalDiv = document.createElement('div');
                internalDiv.style.marginLeft = '15px';
                
                for (let elevatorId = 1; elevatorId <= elevatorSystem?.elevators.length || 2; elevatorId++) {
                    const internalBtn = document.createElement('button');
                    internalBtn.className = 'call-btn';
                    internalBtn.style.background = '#9C27B0';
                    internalBtn.style.color = 'white';
                    internalBtn.style.fontSize = '10px';
                    internalBtn.textContent = `E${elevatorId}`;
                    internalBtn.onclick = () => requestFloor(elevatorId, floor, internalBtn);
                    internalDiv.appendChild(internalBtn);
                }
                
                floorDiv.appendChild(floorNumber);
                floorDiv.appendChild(callsDiv);
                floorDiv.appendChild(internalDiv);
                container.appendChild(floorDiv);
            }
        }

        function generateElevators(numElevators, numFloors) {
            const container = document.getElementById('elevatorsArea');
            container.innerHTML = '';
            
            for (let i = 0; i < numElevators; i++) {
                const elevator = elevatorSystem.elevators[i];
                
                const shaft = document.createElement('div');
                shaft.className = 'elevator-shaft';
                shaft.style.height = `${numFloors * 63 + 20}px`;
                
                const elevatorDiv = document.createElement('div');
                elevatorDiv.className = 'elevator';
                elevatorDiv.id = `elevator-${elevator.elevatorId}`;
                
                elevatorDiv.innerHTML = `
                    <div class="elevator-id">E${elevator.elevatorId}</div>
                    <div class="elevator-floor">${elevator.currentFloor}</div>
                    <div class="elevator-direction">${elevator._getDirectionName(elevator.direction)}</div>
                    <div class="elevator-doors">${elevator.doorState}</div>
                `;
                
                shaft.appendChild(elevatorDiv);
                container.appendChild(shaft);
                
                // Store reference to DOM element
                elevator.element = elevatorDiv;
                elevator.updateVisualPosition();
            }
        }

        function callElevator(floor, direction, button) {
            if (!elevatorSystem) {
                alert('Please initialize the system first!');
                return;
            }
            
            elevatorSystem.callElevator(floor, direction);
            
            // Visual feedback
            button.classList.add('active');
            setTimeout(() => button.classList.remove('active'), 3000);
            
            // Highlight floor
            const floorDiv = document.getElementById(`floor-${floor}`);
            floorDiv.classList.add('active');
            setTimeout(() => floorDiv.classList.remove('active'), 2000);
        }

        function requestFloor(elevatorId, floor, button) {
            if (!elevatorSystem) {
                alert('Please initialize the system first!');
                return;
            }
            
            const elevator = elevatorSystem.elevators[elevatorId - 1];
            if (elevator) {
                elevator.requestFloor(floor);
                
                // Visual feedback
                button.style.background = '#4CAF50';
                button.style.transform = 'scale(1.2)';
                setTimeout(() => {
                    button.style.background = '#9C27B0';
                    button.style.transform = 'scale(1)';
                }, 1000);
            }
        }

        function startSimulation() {
            if (!elevatorSystem) {
                alert('Please initialize the system first!');
                return;
            }
            
            if (isRunning) return;
            
            isRunning = true;
            document.getElementById('startBtn').disabled = true;
            document.getElementById('pauseBtn').disabled = false;
            
            log('‚ñ∂Ô∏è Simulation started', 'info');
            
            simulationInterval = setInterval(() => {
                runSimulationStep();
            }, 100);
        }

        function pauseSimulation() {
            if (!isRunning) return;
            
            isRunning = false;
            document.getElementById('startBtn').disabled = false;
            document.getElementById('pauseBtn').disabled = true;
            
            if (simulationInterval) {
                clearInterval(simulationInterval);
                simulationInterval = null;
            }
            
            log('‚è∏Ô∏è Simulation paused', 'info');
        }

        function resetSimulation() {
            pauseSimulation();
            
            if (elevatorSystem) {
                // Reset all elevators to ground floor
                elevatorSystem.elevators.forEach(elevator => {
                    elevator.currentFloor = 1;
                    elevator.direction = Direction.IDLE;
                    elevator.doorState = DoorState.CLOSED;
                    elevator.floorRequests = [];
                    elevator.hallRequests = [];
                    elevator.isMoving = false;
                    elevator.targetFloor = null;
                    
                    if (elevator.element) {
                        elevator.updateVisualPosition();
                    }
                });
            }
            
            // Clear all active buttons
            document.querySelectorAll('.call-btn.active').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Clear active floors
            document.querySelectorAll('.floor.active').forEach(floor => {
                floor.classList.remove('active');
            });
            
            log('üîÑ Simulation reset', 'info');
            updateStatusDisplay();
        }

        async function runSimulationStep() {
            if (!elevatorSystem || !isRunning) return;
            
            // Update visual positions
            elevatorSystem.elevators.forEach(elevator => {
                elevator.updateVisualPosition();
            });
            
            // Update status display
            updateStatusDisplay();
            
            // Run elevator cycles (non-blocking)
            elevatorSystem.elevators.forEach(async elevator => {
                if (!elevator.isMoving) {
                    elevator.runCycle();
                }
            });
        }

        function updateStatusDisplay() {
            if (!elevatorSystem) return;
            
            const container = document.getElementById('statusContainer');
            const statuses = elevatorSystem.getSystemStatus();
            
            container.innerHTML = '';
            
            statuses.forEach(status => {
                const statusDiv = document.createElement('div');
                statusDiv.className = `elevator-status ${status.isMoving ? 'active' : ''}`;
                
                const requestsText = [
                    ...status.floorRequests.map(f => `F${f}`),
                    ...status.hallRequests.map(r => `${r.floor}${r.direction === 'UP' ? '‚Üë' : '‚Üì'}`)
                ].join(', ') || 'None';
                
                statusDiv.innerHTML = `
                    <div style="font-weight: bold; margin-bottom: 8px;">Elevator ${status.elevatorId}</div>
                    <div class="status-item">
                        <span>Floor:</span>
                        <span>${status.currentFloor}</span>
                    </div>
                    <div class="status-item">
                        <span>Direction:</span>
                        <span>${status.direction}</span>
                    </div>
                    <div class="status-item">
                        <span>Doors:</span>
                        <span>${status.doorState}</span>
                    </div>
                    <div class="status-item">
                        <span>Moving:</span>
                        <span>${status.isMoving ? 'üöö' : '‚èπÔ∏è'}</span>
                    </div>
                    <div class="status-requests">
                        <strong>Requests:</strong> ${requestsText}
                    </div>
                `;
                
                container.appendChild(statusDiv);
            });
        }

        // Quick test scenarios
        function rushHourTest() {
            if (!elevatorSystem) {
                alert('Please initialize the system first!');
                return;
            }
            
            log('üö∂‚Äç‚ôÇÔ∏è Starting rush hour simulation...', 'info');
            
            // Simulate multiple people calling elevators
            const floors = [];
            for (let i = 1; i <= elevatorSystem.maxFloor; i++) {
                floors.push(i);
            }
            
            // Random calls every 500ms for 10 seconds
            let callCount = 0;
            const rushInterval = setInterval(() => {
                const floor = floors[Math.floor(Math.random() * floors.length)];
                const direction = Math.random() > 0.5 ? Direction.UP : Direction.DOWN;
                
                // Make sure direction is valid
                if ((floor === elevatorSystem.maxFloor && direction === Direction.UP) ||
                    (floor === 1 && direction === Direction.DOWN)) {
                    return;
                }
                
                elevatorSystem.callElevator(floor, direction);
                callCount++;
                
                if (callCount >= 20) {
                    clearInterval(rushInterval);
                    log('üö∂‚Äç‚ôÇÔ∏è Rush hour simulation complete', 'info');
                }
            }, 500);
        }

        function randomTest() {
            if (!elevatorSystem) {
                alert('Please initialize the system first!');
                return;
            }
            
            log('üé≤ Starting random test...', 'info');
            
            for (let i = 0; i < 10; i++) {
                setTimeout(() => {
                    const floor = Math.floor(Math.random() * elevatorSystem.maxFloor) + 1;
                    const direction = Math.random() > 0.5 ? Direction.UP : Direction.DOWN;
                    
                    if ((floor === elevatorSystem.maxFloor && direction === Direction.UP) ||
                        (floor === 1 && direction === Direction.DOWN)) {
                        return;
                    }
                    
                    elevatorSystem.callElevator(floor, direction);
                }, i * 1000);
            }
        }

        function stressTest() {
            if (!elevatorSystem) {
                alert('Please initialize the system first!');
                return;
            }
            
            log('‚ö° Starting stress test...', 'info');
            
            // Call all floors simultaneously
            for (let floor = 1; floor <= elevatorSystem.maxFloor; floor++) {
                if (floor < elevatorSystem.maxFloor) {
                    elevatorSystem.callElevator(floor, Direction.UP);
                }
                if (floor > 1) {
                    elevatorSystem.callElevator(floor, Direction.DOWN);
                }
                
                // Add internal requests too
                elevatorSystem.elevators.forEach(elevator => {
                    if (floor !== elevator.currentFloor) {
                        elevator.requestFloor(floor);
                    }
                });
            }
            
            log('‚ö° Stress test: All floors requested!', 'warn');
        }

        function singleFloorTest() {
            if (!elevatorSystem) {
                alert('Please initialize the system first!');
                return;
            }
            
            log('üîù Testing top floor requests...', 'info');
            
            // Send all elevators to top floor
            elevatorSystem.elevators.forEach(elevator => {
                elevator.requestFloor(elevatorSystem.maxFloor);
            });
        }

        // Initialize with default values when page loads
        window.addEventListener('load', () => {
            log('üè¢ Interactive Elevator Simulation Ready!', 'info');
            log('Click "Build System" to create your elevator configuration.', 'info');
        });

        // Handle window resize
        window.addEventListener('resize', () => {
            if (elevatorSystem) {
                elevatorSystem.elevators.forEach(elevator => {
                    elevator.updateVisualPosition();
                });
            }
        });
    </script>
</body>
</html>